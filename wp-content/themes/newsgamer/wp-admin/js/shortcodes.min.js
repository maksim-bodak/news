function base64_decode(e){var t,i,n,r,o,u,c,s,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,d=0,a="",p=[];if(!e)return e;e+="";do r=h.indexOf(e.charAt(l++)),o=h.indexOf(e.charAt(l++)),u=h.indexOf(e.charAt(l++)),c=h.indexOf(e.charAt(l++)),s=r<<18|o<<12|u<<6|c,t=s>>16&255,i=s>>8&255,n=255&s,64==u?p[d++]=String.fromCharCode(t):64==c?p[d++]=String.fromCharCode(t,i):p[d++]=String.fromCharCode(t,i,n);while(l<e.length);return a=p.join(""),a=this.utf8_decode(a)}function base64_encode(e){var t,i,n,r,o,u,c,s,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,d=0,a="",p=[];if(!e)return e;e=this.utf8_encode(e+"");do t=e.charCodeAt(l++),i=e.charCodeAt(l++),n=e.charCodeAt(l++),s=t<<16|i<<8|n,r=s>>18&63,o=s>>12&63,u=s>>6&63,c=63&s,p[d++]=h.charAt(r)+h.charAt(o)+h.charAt(u)+h.charAt(c);while(l<e.length);switch(a=p.join(""),e.length%3){case 1:a=a.slice(0,-2)+"==";break;case 2:a=a.slice(0,-1)+"="}return a}function utf8_decode(e){var t=[],i=0,n=0,r=0,o=0,u=0;for(e+="";i<e.length;)r=e.charCodeAt(i),128>r?(t[n++]=String.fromCharCode(r),i++):r>191&&224>r?(o=e.charCodeAt(i+1),t[n++]=String.fromCharCode((31&r)<<6|63&o),i+=2):(o=e.charCodeAt(i+1),u=e.charCodeAt(i+2),t[n++]=String.fromCharCode((15&r)<<12|(63&o)<<6|63&u),i+=3);return t.join("")}function utf8_encode(e){var t,i,n=e+"",r="",o=0;t=i=0,o=n.length;for(var u=0;o>u;u++){var c=n.charCodeAt(u),s=null;128>c?i++:s=c>127&&2048>c?String.fromCharCode(c>>6|192)+String.fromCharCode(63&c|128):String.fromCharCode(c>>12|224)+String.fromCharCode(c>>6&63|128)+String.fromCharCode(63&c|128),null!==s&&(i>t&&(r+=n.slice(t,i)),r+=s,t=i=u+1)}return i>t&&(r+=n.slice(t,o)),r}jQuery.fn.appendo=function(e){return this.each(function(){jQuery.appendo.init(this,e)}),this},jQuery.appendo=function(){var e=this;return this.opt={},this.init=function(t,i){function n(){var e=d.clone(l.copyHandlers);e.appendTo(t),o(1),"function"==typeof l.onAdd&&l.onAdd(e),l.focusFirst&&e.find("input:first").focus()}function r(){var e=jQuery(t).find(l.subSelect);("function"!=typeof l.onDel||l.onDel(e))&&(e.remove(),o(-1))}function o(e){a+=e||0,l.allowDelete&&a>1?p.show():p.hide()}function u(e){return jQuery("<button />").css(l.buttonStyle).html(e)}function c(e){return e.stopPropagation(),e.preventDefault(),!1}function s(e){return(!l.maxRows||a<l.maxRows)&&n(),c(e)}function h(e){return a>1&&r(),c(e)}var l=jQuery.extend({labelAdd:"Add Row",labelDel:"Remove",allowDelete:!0,copyHandlers:!1,focusFirst:!0,onAdd:function(){return!0},onDel:function(){return!0},maxRows:0,wrapClass:"appendoButtons",wrapStyle:{padding:".4em .2em .5em"},buttonStyle:{marginRight:".5em"},subSelect:"tr:last"},e.opt,i),d=jQuery(t).find(l.subSelect).clone(l.copyHandlers),a=1,p=(jQuery("#form-child-add").click(s),u(l.labelDel).click(h).hide());o()},this}(),function(e){e.extend(e.fn,{livequery:function(t,i,n){var r,o=this;return e.isFunction(t)&&(n=i,i=t,t=void 0),e.each(e.livequery.queries,function(e,u){return o.selector!=u.selector||o.context!=u.context||t!=u.type||i&&i.$lqguid!=u.fn.$lqguid||n&&n.$lqguid!=u.fn2.$lqguid?void 0:(r=u)&&!1}),r=r||new e.livequery(this.selector,this.context,t,i,n),r.stopped=!1,r.run(),this},expire:function(t,i,n){var r=this;return e.isFunction(t)&&(n=i,i=t,t=void 0),e.each(e.livequery.queries,function(o,u){r.selector!=u.selector||r.context!=u.context||t&&t!=u.type||i&&i.$lqguid!=u.fn.$lqguid||n&&n.$lqguid!=u.fn2.$lqguid||this.stopped||e.livequery.stop(u.id)}),this}}),e.livequery=function(t,i,n,r,o){return this.selector=t,this.context=i,this.type=n,this.fn=r,this.fn2=o,this.elements=[],this.stopped=!1,this.id=e.livequery.queries.push(this)-1,r.$lqguid=r.$lqguid||e.livequery.guid++,o&&(o.$lqguid=o.$lqguid||e.livequery.guid++),this},e.livequery.prototype={stop:function(){var e=this;this.type?this.elements.unbind(this.type,this.fn):this.fn2&&this.elements.each(function(t,i){e.fn2.apply(i)}),this.elements=[],this.stopped=!0},run:function(){if(!this.stopped){var t=this,i=this.elements,n=e(this.selector,this.context),r=n.not(i);this.elements=n,this.type?(r.bind(this.type,this.fn),i.length>0&&e.each(i,function(i,r){e.inArray(r,n)<0&&e.event.remove(r,t.type,t.fn)})):(r.each(function(){t.fn.apply(this)}),this.fn2&&i.length>0&&e.each(i,function(i,r){e.inArray(r,n)<0&&t.fn2.apply(r)}))}}},e.extend(e.livequery,{guid:0,queries:[],queue:[],running:!1,timeout:null,checkQueue:function(){if(e.livequery.running&&e.livequery.queue.length)for(var t=e.livequery.queue.length;t--;)e.livequery.queries[e.livequery.queue.shift()].run()},pause:function(){e.livequery.running=!1},play:function(){e.livequery.running=!0,e.livequery.run()},registerPlugin:function(){e.each(arguments,function(t,i){if(e.fn[i]){var n=e.fn[i];e.fn[i]=function(){var t=n.apply(this,arguments);return e.livequery.run(),t}}})},run:function(t){void 0!=t?e.inArray(t,e.livequery.queue)<0&&e.livequery.queue.push(t):e.each(e.livequery.queries,function(t){e.inArray(t,e.livequery.queue)<0&&e.livequery.queue.push(t)}),e.livequery.timeout&&clearTimeout(e.livequery.timeout),e.livequery.timeout=setTimeout(e.livequery.checkQueue,20)},stop:function(t){void 0!=t?e.livequery.queries[t].stop():e.each(e.livequery.queries,function(t){e.livequery.queries[t].stop()})}}),e.livequery.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove","html"),e(function(){e.livequery.play()})}(jQuery),jQuery(document).ready(function(e){var t={loadVals:function(){var t=e("#_miptheme_shortcode").text(),i=t;e(".miptheme-input").each(function(){var t=e(this),n=t.attr("id"),n=n.replace("miptheme_",""),r=new RegExp("{{"+n+"}}","g");i=i.replace(r,t.val())}),e("#_miptheme_ushortcode").remove(),e("#miptheme-popup-form-table").prepend('<div id="_miptheme_ushortcode" class="hidden">'+i+"</div>")},cLoadVals:function(){var t=e("#_miptheme_cshortcode").text(),i="";shortcodes="",e(".child-clone-row").each(function(){var i=(e(this),t);e(".miptheme-cinput",this).each(function(){var t=e(this),n=t.attr("id"),n=n.replace("miptheme_","");re=new RegExp("{{"+n+"}}","g"),i=i.replace(re,t.val())}),shortcodes=shortcodes+i+"\n"}),e("#_miptheme_cshortcodes").remove(),e(".child-clone-rows").prepend('<div id="_miptheme_cshortcodes" class="hidden">'+shortcodes+"</div>"),this.loadVals(),i=e("#_miptheme_ushortcode").text().replace("{{child_shortcode}}",shortcodes),e("#_miptheme_ushortcode").remove(),e("#miptheme-popup-form-table").prepend('<div id="_miptheme_ushortcode" class="hidden">'+i+"</div>")},children:function(){e(".child-clone-rows").appendo({subSelect:"> div.child-clone-row:last-child",allowDelete:!1,focusFirst:!1}),e(".child-clone-row-remove").live("click",function(){var t=e(this),i=t.parent();return e(".child-clone-row").size()>1?i.remove():alert("You need a minimum of one row"),!1}),e(".child-clone-rows").sortable({placeholder:"sortable-placeholder",items:".child-clone-row"})},resizeTB:function(){var t=e("#TB_ajaxContent"),i=e("#TB_window"),n=e("#miptheme-popup");i.css({height:n.outerHeight()+50,width:n.outerWidth(),marginLeft:-(n.outerWidth()/2)}),t.css({paddingTop:0,paddingLeft:0,paddingRight:0,height:i.outerHeight()-47,overflow:"auto",width:n.outerWidth()}),e("#miptheme-popup").addClass("no_preview")},load:function(){{var t=this,i=e("#miptheme-popup"),n=e("#miptheme-popup-form",i);e("#_miptheme_shortcode",n).text(),e("#_miptheme_popup",n).text()}t.resizeTB(),e(window).resize(function(){t.resizeTB()}),t.loadVals(),t.children(),t.cLoadVals(),e(".miptheme-cinput",n).live("change",function(){t.cLoadVals()}),e(".miptheme-input",n).change(function(){t.loadVals()}),e(".miptheme-insert",n).click(function(){parent.tinymce&&(parent.tinymce.activeEditor.execCommand("mceInsertContent",!1,e("#_miptheme_ushortcode",n).html()),tb_remove())})}};e("#miptheme-popup").livequery(function(){t.load()})});